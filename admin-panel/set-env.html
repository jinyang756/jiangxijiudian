<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ±Ÿè¥¿é…’åº—ç®¡ç†é¢æ¿ç¯å¢ƒå˜é‡è®¾ç½®</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.45.4/dist/umd/supabase.js"></script>
</head>
<body class="bg-gray-100">
    <div class="container mx-auto px-4 py-8">
        <h1 class="text-3xl font-bold text-center mb-8">æ±Ÿè¥¿é…’åº—ç®¡ç†é¢æ¿ç¯å¢ƒå˜é‡è®¾ç½®</h1>
        
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">ç¯å¢ƒå˜é‡è®¾ç½®</h2>
            <p class="mb-4">è¯·åœ¨ä¸‹æ–¹è¾“å…¥æ‚¨çš„ Supabase ç¯å¢ƒå˜é‡ï¼š</p>
            
            <div class="mb-4">
                <label class="block text-gray-700 text-sm font-bold mb-2" for="supabaseUrl">
                    Supabase URL
                </label>
                <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" 
                       id="supabaseUrl" type="text" placeholder="https://your-project.supabase.co"
                       value="https://your-project.supabase.co">
            </div>
            
            <div class="mb-4">
                <label class="block text-gray-700 text-sm font-bold mb-2" for="supabaseKey">
                    Supabase Anon Key
                </label>
                <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" 
                       id="supabaseKey" type="password" placeholder="Your Supabase anon key"
                       value="your_supabase_anon_key">
            </div>
            
            <button onclick="saveEnvVars()" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline mr-2">
                ä¿å­˜ç¯å¢ƒå˜é‡
            </button>
            <button onclick="checkEnvVars()" class="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline mr-2">
                æ£€æŸ¥ç¯å¢ƒå˜é‡
            </button>
            <button onclick="testConnection()" class="bg-purple-500 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline">
                æµ‹è¯•è¿æ¥
            </button>
        </div>
        
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">ç¯å¢ƒå˜é‡çŠ¶æ€</h2>
            <div id="envStatus" class="text-gray-500">
                ç‚¹å‡»"æ£€æŸ¥ç¯å¢ƒå˜é‡"æŒ‰é’®æŸ¥çœ‹å½“å‰è®¾ç½®çŠ¶æ€
            </div>
        </div>
        
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">è¿æ¥æµ‹è¯•ç»“æœ</h2>
            <div id="connectionStatus" class="text-gray-500">
                ç‚¹å‡»"æµ‹è¯•è¿æ¥"æŒ‰é’®æµ‹è¯•æ•°æ®åº“è¿æ¥
            </div>
        </div>
        
        <div class="bg-white rounded-lg shadow-md p-6">
            <h2 class="text-xl font-semibold mb-4">è®¿é—®ç®¡ç†é¢æ¿</h2>
            <p class="mb-4">ç¯å¢ƒå˜é‡è®¾ç½®å®Œæˆåï¼Œæ‚¨å¯ä»¥è®¿é—®ç®¡ç†é¢æ¿ï¼š</p>
            <a href="index.html" class="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded inline-block">
                æ‰“å¼€ç®¡ç†é¢æ¿
            </a>
        </div>
    </div>

    <script>
        // ä¿å­˜ç¯å¢ƒå˜é‡åˆ° localStorage
        function saveEnvVars() {
            const supabaseUrlInput = document.getElementById('supabaseUrl');
            const supabaseKeyInput = document.getElementById('supabaseKey');
            
            const supabaseUrl = supabaseUrlInput.value.trim();
            const supabaseKey = supabaseKeyInput.value.trim();
            
            if (!supabaseUrl || !supabaseKey) {
                alert('è¯·å¡«å†™å®Œæ•´çš„ Supabase URL å’Œ Anon Key');
                return;
            }
            
            localStorage.setItem('VITE_APP_DB_URL', supabaseUrl);
            localStorage.setItem('VITE_APP_DB_POSTGRES_PASSWORD', supabaseKey);
            
            // æ›´æ–°è¾“å…¥æ¡†çš„å€¼ä»¥åæ˜ ä¿å­˜çš„å†…å®¹
            supabaseUrlInput.value = supabaseUrl;
            supabaseKeyInput.value = supabaseKey;
            
            alert('ç¯å¢ƒå˜é‡å·²ä¿å­˜ï¼ç°åœ¨æ‚¨å¯ä»¥è®¿é—®ç®¡ç†é¢æ¿äº†ã€‚');
        }
        
        // æ£€æŸ¥ç¯å¢ƒå˜é‡
        function checkEnvVars() {
            const supabaseUrl = localStorage.getItem('VITE_APP_DB_URL');
            const supabaseKey = localStorage.getItem('VITE_APP_DB_POSTGRES_PASSWORD');
            const statusDiv = document.getElementById('envStatus');
            
            if (supabaseUrl && supabaseKey) {
                statusDiv.innerHTML = `
                    <p class="text-green-600 font-bold">âœ… ç¯å¢ƒå˜é‡å·²æ­£ç¡®è®¾ç½®</p>
                    <p><strong>Supabase URL:</strong> ${supabaseUrl}</p>
                    <p><strong>Supabase Anon Key:</strong> ${supabaseKey.substring(0, 20)}... (å·²è®¾ç½®)</p>
                `;
            } else {
                statusDiv.innerHTML = `
                    <p class="text-red-600 font-bold">âŒ ç¯å¢ƒå˜é‡æœªè®¾ç½®æˆ–ä¸å®Œæ•´</p>
                    <p><strong>Supabase URL:</strong> ${supabaseUrl || 'æœªè®¾ç½®'}</p>
                    <p><strong>Supabase Anon Key:</strong> ${supabaseKey ? supabaseKey.substring(0, 20) + '...' : 'æœªè®¾ç½®'}</p>
                    <p class="mt-2">è¯·å¡«å†™ä¸Šæ–¹è¡¨å•å¹¶ç‚¹å‡»"ä¿å­˜ç¯å¢ƒå˜é‡"æŒ‰é’®</p>
                `;
            }
        }
        
        // æµ‹è¯•æ•°æ®åº“è¿æ¥
        async function testConnection() {
            const connectionStatusDiv = document.getElementById('connectionStatus');
            connectionStatusDiv.innerHTML = '<p class="text-yellow-600">ğŸ”„ æ­£åœ¨æµ‹è¯•è¿æ¥...</p>';
            
            try {
                // è·å–ç¯å¢ƒå˜é‡
                const supabaseUrl = document.getElementById('supabaseUrl').value || localStorage.getItem('VITE_APP_DB_URL') || 'https://your-project.supabase.co';
                const supabaseKey = document.getElementById('supabaseKey').value || localStorage.getItem('VITE_APP_DB_POSTGRES_PASSWORD') || 'your_supabase_anon_key';
                
                // åˆ›å»ºSupabaseå®¢æˆ·ç«¯
                const supabase = supabase.createClient(supabaseUrl, supabaseKey);
                
                // æµ‹è¯•è¿æ¥ - è·å–categoriesè¡¨æ•°æ®
                connectionStatusDiv.innerHTML = '<p class="text-yellow-600">ğŸ”„ æ­£åœ¨æŸ¥è¯¢categoriesè¡¨...</p>';
                const { data: categories, error: categoriesError } = await supabase
                    .from('categories')
                    .select('*')
                    .limit(1);
                
                if (categoriesError) {
                    connectionStatusDiv.innerHTML = `
                        <p class="text-red-600 font-bold">âŒ è¿æ¥æµ‹è¯•å¤±è´¥</p>
                        <p><strong>é”™è¯¯ä¿¡æ¯:</strong> ${categoriesError.message}</p>
                        <p class="mt-2">è¯·æ£€æŸ¥Supabase URLå’ŒAnon Keyæ˜¯å¦æ­£ç¡®</p>
                    `;
                    return;
                }
                
                connectionStatusDiv.innerHTML = `
                    <p class="text-green-600 font-bold">âœ… è¿æ¥æµ‹è¯•æˆåŠŸ</p>
                    <p><strong>Supabase URL:</strong> ${supabaseUrl}</p>
                    <p><strong>categoriesè¡¨:</strong> å¯è®¿é—® (${categories.length} æ¡è®°å½•)</p>
                    <p class="mt-2 text-green-600">ğŸ‰ ç¯å¢ƒå˜é‡é…ç½®æ­£ç¡®ï¼Œå¯ä»¥æ­£å¸¸ä½¿ç”¨ç®¡ç†é¢æ¿</p>
                `;
            } catch (error) {
                connectionStatusDiv.innerHTML = `
                    <p class="text-red-600 font-bold">âŒ è¿æ¥æµ‹è¯•å¤±è´¥</p>
                    <p><strong>é”™è¯¯ä¿¡æ¯:</strong> ${error.message}</p>
                    <p class="mt-2">è¯·æ£€æŸ¥ç½‘ç»œè¿æ¥å’ŒSupabaseé…ç½®</p>
                `;
            }
        }
        
        // é¡µé¢åŠ è½½æ—¶ï¼Œå¦‚æœå·²ä¿å­˜ç¯å¢ƒå˜é‡ï¼Œåˆ™è‡ªåŠ¨å¡«å……è¡¨å•
        window.onload = function() {
            const savedUrl = localStorage.getItem('VITE_APP_DB_URL');
            const savedKey = localStorage.getItem('VITE_APP_DB_POSTGRES_PASSWORD');
            
            const supabaseUrlInput = document.getElementById('supabaseUrl');
            const supabaseKeyInput = document.getElementById('supabaseKey');
            
            if (savedUrl) {
                supabaseUrlInput.value = savedUrl;
            }
            
            if (savedKey) {
                supabaseKeyInput.value = savedKey;
            }
        }
    </script>
</body>
</html>